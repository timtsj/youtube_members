<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
               padding: 20px; background-color: var(--tg-theme-bg-color); color: var(--tg-theme-text-color); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 14px; opacity: 0.8; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; 
                        background: var(--tg-theme-secondary-bg-color); color: var(--tg-theme-text-color); }
        button { width: 100%; padding: 15px; background-color: var(--tg-theme-button-color); 
                 color: var(--tg-theme-button-text-color); border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <h3>Регистрация участника</h3>
    <div class="form-group">
        <label>ID пользователя</label>
        <input type="text" id="chat_id" readonly>
    </div>
    <div class="form-group">
        <label>Логин</label>
        <input type="text" id="username" readonly>
    </div>
    <div class="form-group">
        <label>Дата вступления</label>
        <input type="date" id="start_date">
    </div>
    <div class="form-group">
        <label>Срок доступа (мес.)</label>
        <select id="months">
            <option value="1">1 месяц</option>
            <option value="3">3 месяца</option>
            <option value="6">6 месяцев</option>
            <option value="12">12 месяцев</option>
        </select>
    </div>
    <button onclick="sendData()">Добавить в группу</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Автозаполнение данных из URL
        const urlParams = new URLSearchParams(window.location.search);
        document.getElementById('chat_id').value = urlParams.get('id') || '';
        document.getElementById('username').value = '@' + (urlParams.get('user') || 'unknown');
        document.getElementById('start_date').value = new Date().toISOString().split('T')[0];

        async function sendData() {
            const payload = {
                chat_id: document.getElementById('chat_id').value,
                username: document.getElementById('username').value,
                start_date: document.getElementById('start_date').value,
                months: document.getElementById('months').value
            };

            try {
                const response = await fetch('https://ВАШ_URL_N8N/webhook/registration', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                if (response.ok) {
                    tg.showScanQrPopup({text: "Успешно сохранено!"});
                    setTimeout(() => tg.close(), 1000);
                }
            } catch (e) {
                alert("Ошибка связи с n8n");
            }
        }
    </script>
</body>
</html>